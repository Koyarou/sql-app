<!doctype html>
<html lang="fr" data-theme="dark">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>DB Chat ‚Äî D√©mo ludique SQL</title>

<style>
  :root{--bg:#0b0b0b;--panel:#131313;--muted:#191919;--txt:#f7f7f7;--sub:#b7b7b7;--accent:#18a1ff;--bd:#242424;--r:12px}
  html[data-theme="light"]{--bg:#f8fafc;--panel:#ffffff;--muted:#f2f4f7;--txt:#0b0b0f;--sub:#64748b;--accent:#0ea5e9;--bd:#e5e7eb}

  body{margin:0;background:var(--bg);color:var(--txt);font-family:Inter,system-ui,Arial,sans-serif}
  .wrap{max-width:900px;margin:0 auto;padding:16px;display:grid;gap:16px}
  textarea{width:100%;min-height:90px;border:1px solid var(--bd);border-radius:10px;background:transparent;color:var(--txt);padding:10px}
  button{border:1px solid var(--bd);border-radius:10px;background:transparent;color:var(--txt);padding:10px 14px;cursor:pointer}
  .primary{background:var(--accent);border-color:var(--accent);color:#fff}
  h1{margin:0;font-size:22px}
  .chatlog{min-height:120px;border:1px solid var(--bd);border-radius:12px;padding:10px;background:rgba(255,255,255,0.02);overflow:auto}
  .msg{margin:0 0 10px}
  .who{font-size:12px;color:var(--sub);margin-bottom:2px}
  .bubble{background:rgba(255,255,255,0.03);border:1px solid var(--bd);padding:8px;border-radius:10px}

  /* Visualisation */
  .schema {display:flex;flex-wrap:wrap;gap:16px;justify-content:center;margin-top:20px}
  .table-card {
    border-radius:12px;
    padding:12px 16px;
    width:220px;
    color:#fff;
    box-shadow:0 3px 8px rgba(0,0,0,0.3);
    animation:pop 0.3s ease;
    transition:transform .2s;
  }
  .table-card:hover{transform:scale(1.05);}
  @keyframes pop {from{transform:scale(0.9);opacity:0;} to{transform:scale(1);opacity:1;}}
  .table-card h3{margin:0 0 8px;font-size:17px}
  .table-card ul{margin:0;padding-left:16px;list-style:none}
  .table-card li{font-size:13px;margin:3px 0}
  .download {margin-top:20px;text-align:center}
</style>

<script>
document.addEventListener('DOMContentLoaded',()=>{
  const chatlog=document.getElementById('log');
  const schema=document.getElementById('schema');
  const briefEl=document.getElementById('brief');
  const goBtn=document.getElementById('go');
  const downloadBtn=document.getElementById('download');
  const colors=["#1e90ff","#16a34a","#facc15","#ec4899","#8b5cf6"];

  function msg(who,html){
    const d=document.createElement('div');
    d.className='msg';
    d.innerHTML=`<div class="who">${who}</div><div class="bubble">${html}</div>`;
    chatlog.appendChild(d);
    chatlog.scrollTop=chatlog.scrollHeight;
  }

  function demoGenerate(brief){
    const b=brief.toLowerCase();
    if(b.includes("rh")||b.includes("employ√©")||b.includes("collaborateur")){
      return {
        rationale:"Chaque salari√© appartient √† un service ; les contrats sont historis√©s par salari√©. Emails uniques.",
        tables:[
          {name:"employees",fields:[
            {name:"id",type:"INTEGER",pk:true},
            {name:"first_name",type:"TEXT"},
            {name:"last_name",type:"TEXT"},
            {name:"email",type:"TEXT"},
            {name:"department_id",type:"INTEGER"}
          ]},
          {name:"departments",fields:[
            {name:"id",type:"INTEGER",pk:true},
            {name:"name",type:"TEXT"}
          ]},
          {name:"contracts",fields:[
            {name:"id",type:"INTEGER",pk:true},
            {name:"employee_id",type:"INTEGER"},
            {name:"type",type:"TEXT"},
            {name:"start_date",type:"DATE"},
            {name:"end_date",type:"DATE"}
          ]}
        ]
      };
    }
    return {rationale:"Base simple par d√©faut",tables:[]};
  }

  function renderDB(db){
    schema.innerHTML="";
    db.tables.forEach((t,i)=>{
      const card=document.createElement("div");
      card.className="table-card";
      card.style.background=colors[i%colors.length];
      card.innerHTML=`<h3>${t.name}</h3><ul>${
        t.fields.map(f=>`<li>${f.name} (${f.type}) ${f.pk?"üîë":""}</li>`).join("")
      }</ul>`;
      schema.appendChild(card);
    });
  }

  function generateSQL(db){
    let sql="";
    db.tables.forEach(t=>{
      sql+=`CREATE TABLE ${t.name} (\n`;
      sql+=t.fields.map(f=>{
        let def=`  ${f.name} ${f.type}`;
        if(f.pk) def+=" PRIMARY KEY";
        return def;
      }).join(",\n");
      sql+="\n);\n\n";
    });
    return sql;
  }

  goBtn.onclick=()=>{
    const brief=briefEl.value.trim()||"Base RH de d√©mo";
    msg("Vous",brief);
    const db=demoGenerate(brief);
    msg("ü§ñ","Voici une proposition de sch√©ma JSON :<br><pre>"+JSON.stringify(db,null,2)+"</pre>");
    renderDB(db);
    // Activer le bouton t√©l√©chargement
    downloadBtn.onclick=()=>{
      const sql=generateSQL(db);
      const blob=new Blob([sql],{type:"text/sql"});
      const a=document.createElement("a");
      a.href=URL.createObjectURL(blob);
      a.download="demo_rh.sql";
      a.click();
      URL.revokeObjectURL(a.href);
    };
  };
});
</script>
</head>

<body>
  <div class="wrap">
    <h1>DB Chat üéÆ ‚Äî G√©n√©rateur de base SQL ludique</h1>
    <textarea id="brief" placeholder="D√©cris ta base (ex : base RH, employ√©s, contrats...)"></textarea>
    <button class="primary" id="go">G√©n√©rer</button>

    <div class="chatlog" id="log" aria-live="polite"></div>

    <section id="schema" class="schema"></section>

    <div class="download">
      <button id="download" class="primary">‚¨áÔ∏è T√©l√©charger la base SQL</button>
    </div>
  </div>
</body>
</html>
